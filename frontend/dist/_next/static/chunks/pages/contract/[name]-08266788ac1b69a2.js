(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[418],{5668:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/contract/[name]",function(){return a(3932)}])},5613:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var s=a(4848),l=a(5703),r=a.n(l);a(6540);let n=()=>(0,s.jsxs)("div",{style:{animation:"blinking 1s infinite"},className:"jsx-1eabae4ad82e56c0 animate-blink",children:[(0,s.jsx)(r(),{id:"1eabae4ad82e56c0",children:"@-webkit-keyframes blinking{0%{opacity:0}50%{opacity:1}100%{opacity:0}}@-moz-keyframes blinking{0%{opacity:0}50%{opacity:1}100%{opacity:0}}@-o-keyframes blinking{0%{opacity:0}50%{opacity:1}100%{opacity:0}}@keyframes blinking{0%{opacity:0}50%{opacity:1}100%{opacity:0}}"}),"_"]})},38:(e,t,a)=>{"use strict";a.d(t,{A0:()=>i,BF:()=>c,Hj:()=>d,XI:()=>n,nA:()=>u,nd:()=>o});var s=a(4848),l=a(6540),r=a(780);let n=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:(0,r.cn)("w-full caption-bottom text-sm",a),...l})})});n.displayName="Table";let i=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("thead",{ref:t,className:(0,r.cn)("[&_tr]:border-b",a),...l})});i.displayName="TableHeader";let c=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("tbody",{ref:t,className:(0,r.cn)("[&_tr:last-child]:border-0",a),...l})});c.displayName="TableBody",l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("tfoot",{ref:t,className:(0,r.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...l})}).displayName="TableFooter";let d=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("tr",{ref:t,className:(0,r.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...l})});d.displayName="TableRow";let o=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("th",{ref:t,className:(0,r.cn)("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...l})});o.displayName="TableHead";let u=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("td",{ref:t,className:(0,r.cn)("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...l})});u.displayName="TableCell",l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("caption",{ref:t,className:(0,r.cn)("mt-4 text-sm text-muted-foreground",a),...l})}).displayName="TableCaption"},3932:(e,t,a)=>{"use strict";a.r(t),a.d(t,{__N_SSG:()=>S,default:()=>A});var s=a(4848),l=a(6540),r=a(843),n=a(6358),i=a(6715),c=a(3566),d=a(8113),o=a(5130),u=a(9893),h=a(7220),m=a(38),x=a(1807),p=a(1409);a(4338);let j=(e,t)=>{if(!e||e.length<=t)return e;let a=Math.ceil(t/2),s=Math.floor(t/2);return"".concat(e.substring(0,a),"...").concat(e.substring(e.length-s))},v=e=>"PaymentRequested"===e?"Payment Requested":"PurchaseRequested"===e?"Purchase Requested":e;function y(e){var t,a,n,i,y,f;let{contractAddress:g,network:N,paymentType:w}=e,[b,k]=(0,l.useState)([]),[C,S]=(0,l.useState)(!1),[A,T]=(0,l.useState)("all"),[E,W]=(0,l.useState)(""),[R,P]=(0,l.useState)(null),{state:_}=(0,r.Us)();(0,l.useEffect)(()=>{let e=async()=>{S(!0);try{var e,t;console.log("contractAddress",g);let a=new URLSearchParams({...g&&{paymentContractAddress:g},...N&&{network:N},limit:"100"}).toString(),s=await fetch("".concat("/..","/api/v1/payment?").concat(a),{headers:{token:_.apiKey}});if(!s.ok)throw Error("Failed to fetch transactions");let l=await fetch("".concat("/..","/api/v1/purchase?").concat(a),{headers:{token:_.apiKey}});if(!l.ok)throw Error("Failed to fetch transactions");let r=await s.json(),n=await l.json(),i=[...null==r?void 0:null===(e=r.data)||void 0===e?void 0:e.transactions,...null==n?void 0:null===(t=n.data)||void 0===t?void 0:t.transactions];k(i)}catch(e){console.error("Failed to fetch transactions:",e)}finally{S(!1)}};(g||N||w)&&e()},[g,N,w,_.apiKey]);let D=b.filter(e=>{let t="all"===A||"payments"===A&&"payment"===e.type||"purchases"===A&&"purchase"===e.type||"errors"===A&&e.errorType,a=E.toLowerCase(),s=!E||e.identifier.toLowerCase().includes(a)||e.status.toLowerCase().includes(a)||e.txHash&&e.txHash.toLowerCase().includes(a)||e.errorNote&&e.errorNote.toLowerCase().includes(a);return t&&s}),F=(e,t)=>{if(t)return"text-destructive";switch(e.toLowerCase()){case"payment received":case"completed":return"text-green-500";case"processing":case"waiting on output":return"text-yellow-500";case"failed":return"text-destructive";default:return"text-muted-foreground"}};return(0,s.jsxs)(c.Zp,{children:[(0,s.jsxs)(c.aR,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[(0,s.jsx)(c.ZB,{children:"Transactions"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(d.$,{variant:"all"===A?"default":"secondary",onClick:()=>T("all"),children:"All"}),(0,s.jsx)(d.$,{variant:"payments"===A?"default":"secondary",onClick:()=>T("payments"),children:"Payments"}),(0,s.jsx)(d.$,{variant:"purchases"===A?"default":"secondary",onClick:()=>T("purchases"),children:"Purchases"}),(0,s.jsx)(d.$,{variant:"errors"===A?"default":"secondary",onClick:()=>T("errors"),children:"Errors"})]})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(u.A,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(o.p,{placeholder:"Search transactions by ID, status, txHash, error note...",className:"pl-8",value:E,onChange:e=>W(e.target.value)})]})]}),(0,s.jsx)(c.Wu,{children:C?(0,s.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,s.jsx)("div",{className:"text-lg text-muted-foreground",children:"Fetching transactions..."})}):0===D.length?(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"No transactions found."}):(0,s.jsx)("div",{className:"rounded-md border",children:(0,s.jsx)("div",{className:"max-h-[600px] overflow-auto",children:(0,s.jsxs)(m.XI,{children:[(0,s.jsx)(m.A0,{children:(0,s.jsxs)(m.Hj,{children:[(0,s.jsx)(m.nd,{className:"sticky top-0 bg-background",children:"ID"}),(0,s.jsx)(m.nd,{className:"sticky top-0 bg-background",children:"Type"}),(0,s.jsx)(m.nd,{className:"sticky top-0 bg-background",children:"Status"}),(0,s.jsx)(m.nd,{className:"sticky top-0 bg-background",children:"Amount"}),(0,s.jsx)(m.nd,{className:"sticky top-0 bg-background",children:"Network"}),(0,s.jsx)(m.nd,{className:"sticky top-0 bg-background",children:"Payment Type"}),(0,s.jsx)(m.nd,{className:"sticky top-0 bg-background min-w-[100px]",children:"Tx Hash"}),(0,s.jsx)(m.nd,{className:"sticky top-0 bg-background",children:"Date"})]})}),(0,s.jsx)(m.BF,{children:D.map(e=>{var t,a,l,r,n,i;return(0,s.jsxs)(m.Hj,{className:"cursor-pointer ".concat(e.errorType?"bg-destructive/10 hover:bg-destructive/20":"hover:bg-muted/50"),onClick:()=>P(e),children:[(0,s.jsx)(m.nA,{className:"font-medium",children:j(e.identifier,32)}),(0,s.jsx)(m.nA,{children:"payment"===e.type?"Payment":"Purchase"}),(0,s.jsx)(m.nA,{className:F(e.status,!!e.errorType),children:v(e.status)}),(0,s.jsx)(m.nA,{children:(null===(a=e.amounts)||void 0===a?void 0:null===(t=a[0])||void 0===t?void 0:t.amount)?"".concat((e.amounts[0].amount/1e6).toFixed(2)," ₳"):"-"}),(0,s.jsx)(m.nA,{children:(null===(l=e.networkHandler)||void 0===l?void 0:l.network)||(null===(r=e.checkedBy)||void 0===r?void 0:r.network)||"-"}),(0,s.jsx)(m.nA,{children:(null===(n=e.networkHandler)||void 0===n?void 0:n.paymentType)||(null===(i=e.checkedBy)||void 0===i?void 0:i.paymentType)||"-"}),(0,s.jsx)(m.nA,{className:"min-w-[100px]",children:e.txHash?j(e.txHash,16):"-"}),(0,s.jsx)(m.nA,{children:new Date(e.createdAt).toLocaleString()})]},e.identifier)})})]})})})}),(0,s.jsx)(x.lG,{open:!!R,onOpenChange:()=>P(null),children:(0,s.jsxs)(x.Cf,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(x.c7,{children:(0,s.jsx)(x.L3,{children:"Transaction Details"})}),R&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("h4",{className:"font-semibold mb-1",children:"Transaction ID"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-muted/30 rounded-md p-2",children:[(0,s.jsx)("p",{className:"text-sm font-mono break-all",children:j(R.identifier,32)}),(0,s.jsx)(d.$,{variant:"ghost",size:"icon",className:"h-6 w-6 ml-auto shrink-0",onClick:e=>{e.stopPropagation(),navigator.clipboard.writeText(R.identifier),p.oR.success("Transaction ID copied to clipboard!")},children:(0,s.jsx)(h.A,{className:"h-4 w-4"})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold mb-1",children:"Type"}),(0,s.jsx)("p",{className:"text-sm capitalize",children:R.type})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold mb-1",children:"Created"}),(0,s.jsx)("p",{className:"text-sm",children:new Date(R.createdAt).toLocaleString()})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h4",{className:"font-semibold",children:"Transaction Details"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 rounded-md border p-4 bg-muted/10",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-sm font-medium mb-1",children:"Status"}),(0,s.jsx)("p",{className:"text-sm ".concat(F(R.status,!!R.errorType)),children:v(R.status)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-sm font-medium mb-1",children:"Network"}),(0,s.jsx)("p",{className:"text-sm",children:(null===(t=R.checkedBy)||void 0===t?void 0:t.network)||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-sm font-medium mb-1",children:"Payment Type"}),(0,s.jsx)("p",{className:"text-sm",children:(null===(a=R.checkedBy)||void 0===a?void 0:a.paymentType)||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-sm font-medium mb-1",children:"Amount"}),(0,s.jsx)("p",{className:"text-sm",children:(null===(i=R.amounts)||void 0===i?void 0:null===(n=i[0])||void 0===n?void 0:n.amount)?"".concat((R.amounts[0].amount/1e6).toFixed(2)," ₳"):"-"})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("h5",{className:"text-sm font-medium mb-1",children:"Transaction Hash"}),R.txHash?(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-muted/30 rounded-md p-2",children:[(0,s.jsx)("p",{className:"text-sm font-mono break-all",children:R.txHash}),(0,s.jsx)(d.$,{variant:"ghost",size:"icon",className:"h-6 w-6 ml-auto shrink-0",onClick:e=>{e.stopPropagation(),navigator.clipboard.writeText(R.txHash),p.oR.success("Transaction hash copied to clipboard!")},children:(0,s.jsx)(h.A,{className:"h-4 w-4"})})]}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No transaction hash available"})]})]})]}),"payment"===R.type&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h4",{className:"font-semibold",children:"Wallet Information"}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-4 rounded-md border p-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-sm font-medium mb-1",children:"Collection Wallet"}),(0,s.jsx)("p",{className:"text-sm font-mono break-all",children:(null===(y=R.collectionWallet)||void 0===y?void 0:y.walletAddress)||"-"}),(null===(f=R.collectionWallet)||void 0===f?void 0:f.note)&&(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Note: ",R.collectionWallet.note]})]})})]}),R.errorType&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h4",{className:"font-semibold",children:"Error Details"}),(0,s.jsx)("div",{className:"space-y-2 rounded-md bg-destructive/20 p-4",children:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{className:"font-medium",children:"Error Type:"})," ",R.errorType]}),R.errorNote&&(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{className:"font-medium",children:"Error Note:"})," ",R.errorNote]}),R.errorRequiresManualReview&&(0,s.jsx)("p",{className:"text-sm font-medium text-destructive mt-2",children:"⚠️ This error requires manual review"})]})})]})]})]})})]})}var f=a(4625),g=a(5613),N=a(8538);function w(e){let{type:t,address:a,walletId:n,onRemove:i,contract:o,network:u}=e,[m,j]=(0,l.useState)(null),[v,y]=(0,l.useState)(null),[w,b]=(0,l.useState)(!0),[,k]=(0,l.useState)(null),[C]=(0,l.useState)(!1),[S,A]=(0,l.useState)(a||null),[,T]=(0,l.useState)(!1),{state:E}=(0,r.Us)(),[W,R]=(0,l.useState)(!1),[P,_]=(0,l.useState)(!1),[D,F]=(0,l.useState)(!1),[L,O]=(0,l.useState)(null),$="selling"===t?"Selling":"Purchasing",H=(0,l.useCallback)(async()=>{try{T(!0);let e=await fetch("".concat("/..","/api/v1/wallet?walletType=").concat($,"&id=").concat(n),{headers:{accept:"application/json",token:E.apiKey}});if(!e.ok)throw Error("Failed to fetch wallet address");return(await e.json()).data.address}catch(e){return console.error("Error fetching wallet address:",e),null}finally{T(!1)}},[E.apiKey,$,n]);(0,l.useEffect)(()=>{!S&&n&&H().then(e=>{e&&A(e)})},[S,n,H]);let K=(0,l.useCallback)(async e=>{try{b(!0);let t=await fetch("".concat("/..","/api/v1/utxos?address=").concat(e,"&count=100&order=asc&page=1&network=").concat("mainnet"===u.toLowerCase()?"MAINNET":"PREPROD"),{headers:{accept:"application/json",token:E.apiKey}});if(!t.ok)throw Error("Error: ".concat(t.statusText));let a=await t.json();console.log("u",a);let s=a.data.utxos.reduce((e,t)=>{let a=t.amount.find(e=>"lovelace"===e.unit);return e+(a?a.quantity:0)},0),l=a.data.utxos.reduce((e,t)=>{let a=t.amount.find(e=>{var t;return null===(t=e.unit)||void 0===t?void 0:t.startsWith("c48cbb3d5e57ed56e276bc45f99ab39abe94e6cd7ac39fb402da47ad")});return e+(a?a.quantity:0)},0);return{ada:(s/1e6).toFixed(1),usdm:l.toFixed(1)}}catch(e){return console.error("Error fetching balance:",e.message),null}},[E.apiKey,u]);(0,l.useEffect)(()=>{let e=async()=>{var e;let t=null===(e=E.paymentSources)||void 0===e?void 0:e[0];if(!(null==t?void 0:t.rpcProviderApiKey)){console.error("No Blockfrost API key found");return}try{b(!0),k(null);let e=await K(S||"");j((null==e?void 0:e.ada)||"0"),y((null==e?void 0:e.usdm)||"0"),b(!1)}catch(e){console.error("Error fetching wallet balances:",e),b(!1),k(e)}};S&&e()},[S,E.paymentSources,E.apiKey,K]);let U=async e=>{e.stopPropagation(),_(!0);try{let e=await fetch("".concat("/..","/api/v1/wallet?walletType=").concat($,"&id=").concat(n,"&includeSecret=true"),{headers:{accept:"application/json",token:E.apiKey}});if(!e.ok)throw Error("Failed to export wallet");let t=await e.json();O(t.data.WalletSecret.secret),F(!0)}catch(e){console.error("Error exporting wallet:",e),p.oR.error("Failed to export wallet")}finally{_(!1)}},B=(e,t)=>{e.stopPropagation(),navigator.clipboard.writeText(t),p.oR.success("Address copied to clipboard!")};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Zp,{className:"bg-[#ffffff03] hover:bg-[#ffffff06]",children:(0,s.jsxs)(c.Wu,{className:"space-y-1 py-4 px-3 flex flex-col gap-3",children:[(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsxs)("div",{className:"text-sm truncate flex-1",children:["Address: ",S?"".concat(S.slice(0,8),"...").concat(S.slice(-8)):(0,s.jsx)(g.A,{}),S&&(0,s.jsx)(d.$,{variant:"ghost",size:"icon",className:"h-4 w-4 ml-2",onClick:e=>B(e,S||""),children:(0,s.jsx)(h.A,{className:"h-3 w-3"})})]})}),(0,s.jsx)("div",{className:"grid gap-2",children:w?(0,s.jsx)("div",{className:"text-sm",children:"fetching balance..."}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"text-sm",children:["ADA Balance: ",(null==m?void 0:m.toLocaleString())||"..."," ₳"]}),(0,s.jsxs)("div",{className:"text-sm",children:["USDM Balance: ",(null==v?void 0:v.toLocaleString())||"..."," USDM"]})]})}),(0,s.jsx)("div",{className:"flex gap-1 justify-start mt-1",children:("purchasing"===t||"selling"===t)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.$,{variant:"secondary",size:"sm",onClick:e=>{var a;if(e.stopPropagation(),"preprod"===(null===(a=o.network)||void 0===a?void 0:a.toLowerCase())){window.open("https://docs.cardano.org/cardano-testnets/tools/faucet","_blank");return}let s=new f.d({apiKey:N.env.NEXT_PUBLIC_TRANSAK_API_KEY,environment:"PRODUCTION",defaultCryptoCurrency:"ADA",walletAddress:S||"",defaultNetwork:"mainnet"===t?"cardano":"cardano_preprod",cryptoCurrencyList:"ADA",defaultPaymentMethod:"credit_debit_card",exchangeScreenTitle:"Top up your wallet",hideMenu:!0,themeColor:"#000000",hostURL:window.location.origin,widgetHeight:"650px",widgetWidth:"450px"});s.init(),s.on(s.EVENTS.TRANSAK_WIDGET_CLOSE,()=>{s.close()}),s.on(s.EVENTS.TRANSAK_ORDER_SUCCESSFUL,e=>{console.log("Order successful:",e),s.close()})},disabled:P,children:"Top up"}),(0,s.jsx)(d.$,{variant:"secondary",size:"sm",onClick:U,disabled:P,children:P?"Exporting...":"Export"})]})})]}),("purchasing"===t||"selling"===t)&&n&&(0,s.jsx)(d.$,{variant:"destructive",size:"sm",onClick:e=>{e.stopPropagation(),R(!0)},disabled:C,style:{maxWidth:"100px"},children:"Remove Wallet"})]})}),(0,s.jsx)(x.lG,{open:W,onOpenChange:R,children:(0,s.jsxs)(x.Cf,{children:[(0,s.jsxs)(x.c7,{children:[(0,s.jsx)(x.L3,{children:"Remove Wallet"}),(0,s.jsx)(x.rr,{children:"Are you sure you want to remove this wallet? This action cannot be undone."})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>R(!1),disabled:C,children:"Cancel"}),(0,s.jsx)(d.$,{variant:"destructive",onClick:e=>{e.stopPropagation(),null==i||i(),R(!1)},disabled:C,children:"Remove Wallet"})]})]})}),(0,s.jsx)(x.lG,{open:D,onOpenChange:F,children:(0,s.jsxs)(x.Cf,{children:[(0,s.jsxs)(x.c7,{children:[(0,s.jsx)(x.L3,{children:"Wallet Secret"}),(0,s.jsx)(x.rr,{children:"Please store this secret phrase securely. Anyone with access to this phrase can control the wallet."})]}),(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsx)("div",{className:"p-4 bg-muted rounded-md",children:(0,s.jsx)("p",{className:"text-sm break-all font-mono",children:L})})}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)(d.$,{onClick:()=>{navigator.clipboard.writeText(L||""),p.oR.success("Secret copied to clipboard!")},children:"Copy to Clipboard"}),(0,s.jsx)(d.$,{variant:"outline",onClick:()=>{F(!1),O(null)},children:"Close"})]})]})})]})}async function b(e,t){if(!e.id)throw Error("Payment source ID is required");if(!t)throw Error("Authorization token is required");try{let a=await fetch("".concat("/..","/api/v1/payment-source"),{method:"PATCH",headers:{accept:"application/json","Content-Type":"application/json",token:t},body:JSON.stringify({id:e.id,latestIdentifier:e.latestIdentifier,page:e.page,blockfrostApiKey:e.blockfrostApiKey,CollectionWallet:e.CollectionWallet,AddPurchasingWallets:e.AddPurchasingWallets,AddSellingWallets:e.AddSellingWallets,RemovePurchasingWallets:e.RemovePurchasingWallets,RemoveSellingWallets:e.RemoveSellingWallets})}),s=await a.json();if(!a.ok)throw Error(s.message||"Failed to update payment source");return{status:"success",data:s}}catch(e){throw console.error("Update payment source failed:",e),e}}var k=a(6344);function C(e){let{type:t,onClose:a,contractId:n}=e,[i,c]=(0,l.useState)(""),[u,h]=(0,l.useState)(""),[m,p]=(0,l.useState)(!1),[j,v]=(0,l.useState)(""),{state:y,dispatch:f}=(0,r.Us)(),g=async e=>{e.preventDefault(),v(""),p(!0);try{var s;await b({id:n,["".concat("purchasing"===t?"AddPurchasingWallets":"AddSellingWallets")]:[{walletMnemonic:i,note:u||void 0}]},y.apiKey);let e=await (0,k.z)(y.apiKey),l=((null==e?void 0:null===(s=e.data)||void 0===s?void 0:s.paymentSources)||[]).find(e=>e.id===n);if(!l)throw Error("Updated contract not found in response");f({type:"SET_PAYMENT_SOURCES",payload:y.paymentSources.map(e=>e.id===n?l:e)}),a()}catch(e){v(e.message||"Failed to add wallet")}finally{p(!1)}};return(0,s.jsxs)(x.Cf,{children:[(0,s.jsxs)(x.c7,{children:[(0,s.jsxs)(x.L3,{children:["Add ",t.charAt(0).toUpperCase()+t.slice(1)," Wallet"]}),(0,s.jsx)(x.rr,{children:"Enter the wallet mnemonic phrase and an optional note."})]}),(0,s.jsxs)("form",{onSubmit:g,className:"space-y-4",children:[j&&(0,s.jsx)("div",{className:"text-sm text-destructive bg-destructive/10 p-3 rounded-md",children:j}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{className:"text-sm font-medium",children:["Mnemonic Phrase ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)("textarea",{className:"w-full min-h-[100px] p-2 rounded-md bg-background border",value:i,onChange:e=>c(e.target.value),placeholder:"Enter your 24-word mnemonic phrase",required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Note (optional)"}),(0,s.jsx)(o.p,{value:u,onChange:e=>h(e.target.value),placeholder:"Enter a note for this wallet"})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(d.$,{type:"button",variant:"outline",onClick:a,disabled:m,children:"Cancel"}),(0,s.jsx)(d.$,{type:"submit",disabled:!i||m,children:m?"Adding...":"Add Wallet"})]})]})]})}var S=!0;function A(e){var t,a,u,h,m,j;let{initialContract:v}=e,f=(0,i.useRouter)(),{name:N}=f.query,{state:S,dispatch:A}=(0,r.Us)(),T=(null===(t=S.paymentSources)||void 0===t?void 0:t.find(e=>e.name===N||e.id===N))||v,[E,W]=(0,l.useState)(!1),[R,P]=(0,l.useState)("purchasing"),[_,D]=(0,l.useState)(!1),[F,L]=(0,l.useState)((null==T?void 0:null===(a=T.CollectionWallet)||void 0===a?void 0:a.walletAddress)||""),[O,$]=(0,l.useState)((null==T?void 0:null===(u=T.CollectionWallet)||void 0===u?void 0:u.note)||""),[H,K]=(0,l.useState)(!1),[U,B]=(0,l.useState)(!1),[I,q]=(0,l.useState)(null),[z,M]=(0,l.useState)(!1),Z=e=>{P(e),W(!0)},G=async()=>{try{var e;M(!0),await b({id:T.id,CollectionWallet:{walletAddress:F,note:O||void 0}},S.apiKey);let t=await (0,k.z)(S.apiKey),a=null===(e=t.data)||void 0===e?void 0:e.paymentSources.find(e=>e.id===T.id);if(!a)throw Error("Updated contract not found in response");A({type:"SET_PAYMENT_SOURCES",payload:S.paymentSources.map(e=>e.id===T.id?a:e)}),D(!1),p.oR.success("Collection wallet updated successfully",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})}catch(e){console.error("Failed to update collection wallet:",e),p.oR.error("Failed to update collection wallet",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})}finally{M(!1)}},X=async()=>{try{var e;if(B(!0),q(null),console.log("delete-contract id",T.id),!(await fetch("".concat("/..","/api/v1/payment-source?id=").concat(T.id),{method:"DELETE",headers:{token:S.apiKey}})).ok)throw Error("Failed to delete contract");A({type:"SET_PAYMENT_SOURCES",payload:(null===(e=S.paymentSources)||void 0===e?void 0:e.filter(e=>e.id!==T.id))||[]}),K(!1),f.push("/")}catch(e){console.error("Failed to delete contract:",e),q(e instanceof Error?e.message:"An unexpected error occurred")}finally{B(!1)}},Y=async(e,t)=>{try{var a;await b({id:T.id,["".concat("purchasing"===e?"RemovePurchasingWallets":"RemoveSellingWallets")]:[{id:t}]},S.apiKey);let s=await (0,k.z)(S.apiKey),l=null===(a=s.data)||void 0===a?void 0:a.paymentSources.find(e=>e.id===T.id);if(!l)throw Error("Updated contract not found in response");A({type:"SET_PAYMENT_SOURCES",payload:S.paymentSources.map(e=>e.id===T.id?l:e)})}catch(e){p.oR.error("Failed to remove wallet "+e.message)}};T&&console.log("contract",T);let V=(null==T?void 0:T.index)||S.paymentSources.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()).map(e=>e).indexOf(T)+1;return(0,s.jsxs)(n.O,{children:[T?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(c.Zp,{children:[(0,s.jsx)(c.aR,{children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[V&&(0,s.jsxs)(c.ZB,{children:["Payment Source #",V]}),(0,s.jsx)(d.$,{variant:"destructive",size:"sm",onClick:()=>K(!0),children:"Delete Contract"})]})}),(0,s.jsx)(c.Wu,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:["Address: ",T.addressToCheck||T.paymentContractAddress]}),(0,s.jsxs)("div",{children:["Network: ",T.network]}),(0,s.jsxs)("div",{children:["Status: ",T.isSyncing?"Syncing":"Active"]}),(0,s.jsxs)("div",{children:["Date Created: ",new Date(T.createdAt).toLocaleString()]})]})})]}),(0,s.jsxs)(c.Zp,{children:[(0,s.jsx)(c.aR,{children:(0,s.jsx)(c.ZB,{children:"Smart Contract Wallets"})}),(0,s.jsx)(c.Wu,{className:"grid grid-cols-3 gap-4",children:null===(h=T.AdminWallets)||void 0===h?void 0:h.map(e=>(0,s.jsx)(w,{type:"admin",address:e.walletAddress,contractName:N,contract:T,network:T.network},e.walletAddress))})]}),(0,s.jsxs)(c.Zp,{children:[(0,s.jsx)(c.aR,{children:(0,s.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[(0,s.jsx)(c.ZB,{children:"Collection Wallet"}),(0,s.jsxs)(d.$,{variant:"secondary",onClick:()=>D(!0),children:[T.CollectionWallet?"Update":"Set"," Collection Wallet"]})]})}),(0,s.jsx)(c.Wu,{children:T.CollectionWallet?(0,s.jsx)(w,{type:"collection",address:T.CollectionWallet.walletAddress,contractName:N,contract:T,network:T.network}):(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"No collection wallet configured"})})]}),(0,s.jsxs)(c.Zp,{children:[(0,s.jsxs)(c.aR,{className:"flex flex-row items-center justify-between",children:[(0,s.jsx)(c.ZB,{children:"Purchasing Wallets"}),(0,s.jsx)(d.$,{variant:"secondary",onClick:()=>Z("purchasing"),children:"Add Wallet"})]}),(0,s.jsxs)(c.Wu,{children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground mb-4",children:(0,s.jsx)("i",{className:"text-muted-foreground",children:"Handles purchase transactions"})}),(null===(m=T.PurchasingWallets)||void 0===m?void 0:m.length)>0?(0,s.jsx)("div",{className:"grid grid-cols-1 gap-4",children:T.PurchasingWallets.map(e=>(0,s.jsx)(w,{contract:T,type:"purchasing",address:e.walletAddress,contractName:N,walletId:e.id,network:T.network,onRemove:()=>Y("purchasing",e.id)},e.id))}):(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"No purchasing wallets added"})]})]}),(0,s.jsxs)(c.Zp,{children:[(0,s.jsxs)(c.aR,{className:"flex flex-row items-center justify-between",children:[(0,s.jsx)(c.ZB,{children:"Selling Wallets"}),(0,s.jsx)(d.$,{variant:"secondary",onClick:()=>Z("selling"),children:"Add Wallet"})]}),(0,s.jsxs)(c.Wu,{children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground mb-4",children:(0,s.jsx)("i",{className:"text-muted-foreground",children:"Handles selling transactions"})}),(null===(j=T.SellingWallets)||void 0===j?void 0:j.length)>0?(0,s.jsx)("div",{className:"grid grid-cols-1 gap-4",children:T.SellingWallets.map(e=>(0,s.jsx)(w,{contract:T,type:"selling",address:e.walletAddress,contractName:N,walletId:e.id,network:T.network,onRemove:()=>Y("selling",e.id)},e.id))}):(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"No selling wallets added"})]})]}),(0,s.jsx)(y,{contractAddress:T.addressToCheck||T.paymentContractAddress,network:T.network,contract:T,paymentType:T.paymentType||"WEB3_CARDANO_V1"})]}):(0,s.jsx)(g.A,{}),E&&(0,s.jsx)(x.lG,{open:E,onOpenChange:W,children:(0,s.jsx)(C,{type:R,onClose:()=>W(!1),contractId:T.id})}),_&&(0,s.jsx)(x.lG,{open:_,onOpenChange:D,children:(0,s.jsxs)(x.Cf,{children:[(0,s.jsxs)(x.c7,{children:[(0,s.jsx)(x.L3,{children:"Set Collection Wallet Address"}),(0,s.jsx)(x.rr,{children:"Enter the wallet address that will receive the payments after they are processed by the Hot Wallet."})]}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),G()},className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(o.p,{placeholder:"Enter wallet address",value:F,onChange:e=>L(e.target.value),required:!0,pattern:"^addr(_test)?1[a-zA-Z0-9]+$",title:"Please enter a valid Cardano address starting with 'addr1' or 'addr_test1'",disabled:z}),!F&&(0,s.jsx)("p",{className:"text-sm text-destructive",children:"Collection wallet address is required"})]}),(0,s.jsx)("div",{className:"grid gap-2",children:(0,s.jsx)(o.p,{placeholder:"Enter note (optional)",value:O,onChange:e=>$(e.target.value),disabled:z})}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(d.$,{type:"button",variant:"outline",onClick:()=>D(!1),disabled:z,children:"Cancel"}),(0,s.jsx)(d.$,{type:"submit",disabled:!F||z,children:z?"Updating...":"Save Address"})]})]})]})}),H&&(0,s.jsx)(x.lG,{open:H,onOpenChange:K,children:(0,s.jsxs)(x.Cf,{children:[(0,s.jsxs)(x.c7,{children:[(0,s.jsx)(x.L3,{children:"Delete Contract"}),(0,s.jsx)(x.rr,{className:"text-destructive",children:"This action is irreversible. All associated wallets and configurations will be permanently deleted."})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Are you sure you want to delete this contract?"}),I&&(0,s.jsx)("p",{className:"text-sm text-destructive",children:I}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>K(!1),disabled:U,children:"Cancel"}),(0,s.jsx)(d.$,{variant:"destructive",onClick:X,disabled:U,children:U?"Deleting...":"Delete Contract"})]})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[893,690,627,551,523,75,484,974,636,593,792],()=>t(5668)),_N_E=e.O()}]);