(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{2022:(e,l,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(6944)}])},38:(e,l,s)=>{"use strict";s.d(l,{A0:()=>i,BF:()=>c,Hj:()=>d,XI:()=>r,nA:()=>m,nd:()=>o});var t=s(4848),a=s(6540),n=s(780);let r=a.forwardRef((e,l)=>{let{className:s,...a}=e;return(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:l,className:(0,n.cn)("w-full caption-bottom text-sm",s),...a})})});r.displayName="Table";let i=a.forwardRef((e,l)=>{let{className:s,...a}=e;return(0,t.jsx)("thead",{ref:l,className:(0,n.cn)("[&_tr]:border-b",s),...a})});i.displayName="TableHeader";let c=a.forwardRef((e,l)=>{let{className:s,...a}=e;return(0,t.jsx)("tbody",{ref:l,className:(0,n.cn)("[&_tr:last-child]:border-0",s),...a})});c.displayName="TableBody",a.forwardRef((e,l)=>{let{className:s,...a}=e;return(0,t.jsx)("tfoot",{ref:l,className:(0,n.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a})}).displayName="TableFooter";let d=a.forwardRef((e,l)=>{let{className:s,...a}=e;return(0,t.jsx)("tr",{ref:l,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a})});d.displayName="TableRow";let o=a.forwardRef((e,l)=>{let{className:s,...a}=e;return(0,t.jsx)("th",{ref:l,className:(0,n.cn)("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a})});o.displayName="TableHead";let m=a.forwardRef((e,l)=>{let{className:s,...a}=e;return(0,t.jsx)("td",{ref:l,className:(0,n.cn)("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...a})});m.displayName="TableCell",a.forwardRef((e,l)=>{let{className:s,...a}=e;return(0,t.jsx)("caption",{ref:l,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",s),...a})}).displayName="TableCaption"},6944:(e,l,s)=>{"use strict";s.r(l),s.d(l,{__N_SSG:()=>N,default:()=>w});var t=s(4848),a=s(6358),n=s(6540),r=s(3566),i=s(780);function c(e){let{className:l,...s}=e;return(0,t.jsx)("div",{className:(0,i.cn)("animate-pulse rounded-md bg-muted",l),...s})}var d=s(38),o=s(843),m=s(6715),u=s(8113),x=s(1807),p=s(6897);async function h(e,l){var s;if(!e.blockfrostApiKey||!(null===(s=e.AdminWallets)||void 0===s?void 0:s.length))throw Error("Missing required fields");try{let s=await fetch("".concat("http://localhost:3001/","/api/v1/payment-source"),{method:"POST",headers:{accept:"application/json","Content-Type":"application/json",token:l},body:JSON.stringify({network:e.network,paymentType:e.paymentType,blockfrostApiKey:e.blockfrostApiKey,AdminWallets:e.AdminWallets,FeeReceiverNetworkWallet:e.FeeReceiverNetworkWallet,FeePermille:e.FeePermille,CollectionWallet:e.CollectionWallet,PurchasingWallets:e.PurchasingWallets,SellingWallets:e.SellingWallets})}),t=await s.json();if(!s.ok)throw Error(t.message||"Failed to create payment source");return{status:"success",data:t}}catch(e){throw console.error("Create payment source failed:",e),e}}var f=s(6344);let j={network:"PREPROD",paymentType:"WEB3_CARDANO_V1",blockfrostApiKey:"",adminWallets:[{walletAddress:""}],feeReceiverWallet:{walletAddress:""},feePermille:50,collectionWallet:{walletAddress:"",note:""},purchasingWallets:[{walletMnemonic:"",note:""}],sellingWallets:[{walletMnemonic:"",note:""}]};function g(e){var l,s,a,r;let{onClose:i}=e,{state:c}=(0,o.Us)(),d=(null===(s=c.paymentSources)||void 0===s?void 0:null===(l=s[0])||void 0===l?void 0:l.blockfrostApiKey)||"",[m,g]=(0,n.useState)({...j,blockfrostApiKey:d}),[v,y]=(0,n.useState)(""),[b,N]=(0,n.useState)(!1),{dispatch:w}=(0,o.Us)(),W=async()=>{y(""),N(!0);try{var e;if(!m.blockfrostApiKey.trim()){y("Blockfrost API key is required");return}if(!m.adminWallets.some(e=>e.walletAddress.trim())){y("At least one admin wallet is required");return}if(!m.feeReceiverWallet.walletAddress.trim()){y("Fee receiver wallet is required");return}if(!m.collectionWallet.walletAddress.trim()){y("Collection wallet is required");return}let l={network:m.network,paymentType:m.paymentType,blockfrostApiKey:m.blockfrostApiKey,AdminWallets:m.adminWallets.filter(e=>e.walletAddress.trim()),FeeReceiverNetworkWallet:m.feeReceiverWallet,FeePermille:m.feePermille,CollectionWallet:m.collectionWallet,PurchasingWallets:m.purchasingWallets.filter(e=>e.walletMnemonic.trim()),SellingWallets:m.sellingWallets.filter(e=>e.walletMnemonic.trim())};await h(l,c.apiKey);let s=await (0,f.z)(c.apiKey);w({type:"SET_PAYMENT_SOURCES",payload:(null==s?void 0:null===(e=s.data)||void 0===e?void 0:e.paymentSources)||[]}),i()}catch(e){console.error("Failed to create payment source:",e),y(e instanceof Error?e.message:"Failed to create payment source. Please try again.")}finally{N(!1)}};return(0,t.jsx)(x.lG,{open:!0,onOpenChange:i,children:(0,t.jsxs)(x.Cf,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsx)(x.c7,{children:(0,t.jsx)(x.L3,{children:"Add New Payment Source"})}),(0,t.jsxs)("div",{className:"space-y-6 py-4",children:[v&&(0,t.jsx)("div",{className:"text-sm text-destructive",children:v}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Basic Configuration"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["Network ",(0,t.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,t.jsxs)("select",{className:"w-full p-2 rounded-md bg-background border",value:m.network,onChange:e=>g({...m,network:e.target.value}),children:[(0,t.jsx)("option",{value:"PREPROD",children:"Preprod"}),(0,t.jsx)("option",{value:"MAINNET",children:"Mainnet"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["Blockfrost API Key ",(0,t.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,t.jsx)("input",{type:"text",className:"w-full p-2 rounded-md bg-background border",value:m.blockfrostApiKey,onChange:e=>g({...m,blockfrostApiKey:e.target.value}),placeholder:"Using default Blockfrost API key",disabled:null===(r=c.paymentSources)||void 0===r?void 0:null===(a=r[0])||void 0===a?void 0:a.blockfrostApiKey})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["Fee Permille ",(0,t.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,t.jsx)("input",{type:"number",className:"w-full p-2 rounded-md bg-background border",value:m.feePermille,onChange:e=>g({...m,feePermille:parseInt(e.target.value)}),min:"0",max:"1000"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold",children:["Admin Wallets ",(0,t.jsx)("span",{className:"text-muted-foreground",children:"(*3 expected)"})]}),(0,t.jsx)(u.$,{type:"button",variant:"secondary",onClick:()=>{g({...m,adminWallets:[...m.adminWallets,{walletAddress:""}]})},children:"Add Admin Wallet"})]}),m.adminWallets.map((e,l)=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["Admin Wallet Address ",l+1]}),(0,t.jsx)("input",{type:"text",className:"w-full p-2 rounded-md bg-background border",value:e.walletAddress,onChange:e=>{let s=[...m.adminWallets];s[l].walletAddress=e.target.value,g({...m,adminWallets:s})},placeholder:"Enter wallet address"})]},l))]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Fee Receiver Wallet"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["Wallet Address ",(0,t.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,t.jsx)("input",{type:"text",className:"w-full p-2 rounded-md bg-background border",value:m.feeReceiverWallet.walletAddress,onChange:e=>g({...m,feeReceiverWallet:{walletAddress:e.target.value}}),placeholder:"Enter fee receiver wallet address"})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Collection Wallet"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"text-sm font-medium",children:["Wallet Address ",(0,t.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,t.jsx)("input",{type:"text",className:"w-full p-2 rounded-md bg-background border",value:m.collectionWallet.walletAddress,onChange:e=>g({...m,collectionWallet:{...m.collectionWallet,walletAddress:e.target.value}}),placeholder:"Enter collection wallet address"}),(0,t.jsx)("input",{type:"text",className:"w-full p-2 rounded-md bg-background border",value:m.collectionWallet.note||"",onChange:e=>g({...m,collectionWallet:{...m.collectionWallet,note:e.target.value}}),placeholder:"Note (optional)"})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Purchasing Wallets"}),(0,t.jsx)(u.$,{type:"button",variant:"secondary",onClick:()=>{g({...m,purchasingWallets:[...m.purchasingWallets,{walletMnemonic:""}]})},children:"Add Purchasing Wallet"})]}),m.purchasingWallets.map((e,l)=>(0,t.jsxs)("div",{className:"space-y-2 relative",children:[(0,t.jsxs)("div",{className:"text-sm font-medium flex items-center justify-start space-x-2",children:[(0,t.jsxs)("span",{children:["Purchasing Wallet ",l+1]}),l>0&&(0,t.jsx)(u.$,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{let e=m.purchasingWallets.filter((e,s)=>s!==l);g({...m,purchasingWallets:e})},children:(0,t.jsx)(p.A,{className:"h-4 w-4"})})]}),(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("input",{type:"text",className:"w-full p-2 rounded-md bg-background border",value:e.walletMnemonic,onChange:e=>{let s=[...m.purchasingWallets];s[l].walletMnemonic=e.target.value,g({...m,purchasingWallets:s})},placeholder:"Enter wallet mnemonic"})}),(0,t.jsx)("input",{type:"text",className:"w-full p-2 rounded-md bg-background border",value:e.note||"",onChange:e=>{let s=[...m.purchasingWallets];s[l].note=e.target.value,g({...m,purchasingWallets:s})},placeholder:"Note (optional)"})]},l))]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Selling Wallets"}),(0,t.jsx)(u.$,{type:"button",variant:"secondary",onClick:()=>{g({...m,sellingWallets:[...m.sellingWallets,{walletMnemonic:"",note:""}]})},children:"Add Selling Wallet"})]}),m.sellingWallets.map((e,l)=>(0,t.jsxs)("div",{className:"space-y-2 relative",children:[(0,t.jsxs)("div",{className:"text-sm font-medium flex items-center justify-start space-x-2",children:[(0,t.jsxs)("span",{children:["Selling Wallet ",l+1]}),l>0&&(0,t.jsx)(u.$,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{let e=m.sellingWallets.filter((e,s)=>s!==l);g({...m,sellingWallets:e})},children:(0,t.jsx)(p.A,{className:"h-4 w-4"})})]}),(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("input",{type:"text",className:"w-full p-2 rounded-md bg-background border",value:e.walletMnemonic,onChange:e=>{let s=[...m.sellingWallets];s[l].walletMnemonic=e.target.value,g({...m,sellingWallets:s})},placeholder:"Enter wallet mnemonic"})}),(0,t.jsx)("input",{type:"text",className:"w-full p-2 rounded-md bg-background border",value:e.note||"",onChange:e=>{let s=[...m.sellingWallets];s[l].note=e.target.value,g({...m,sellingWallets:s})},placeholder:"Note (optional)"})]},l))]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(u.$,{variant:"secondary",onClick:i,disabled:b,children:"Cancel"}),(0,t.jsx)(u.$,{onClick:W,disabled:b,children:b?"Creating...":"Create Payment Source"})]})]})})}function v(e){let{paymentSourceData:l}=e,s=(0,m.useRouter)(),[a,i]=(0,n.useState)(!0),{state:x}=(0,o.Us)(),p=x.paymentSources||[],[h,f]=(0,n.useState)(!1),j=e=>{s.push("/contract/".concat(e))};return((0,n.useEffect)(()=>{void 0!==l&&i(!1)},[l]),a)?(0,t.jsxs)(r.Zp,{children:[(0,t.jsx)(r.aR,{children:(0,t.jsx)(r.ZB,{children:"Monitored Contracts"})}),(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(c,{className:"h-[200px]"})})]}):(0,t.jsxs)(r.Zp,{children:[(0,t.jsxs)(r.aR,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)(r.ZB,{children:"Monitored Contracts"}),(0,t.jsx)(u.$,{onClick:()=>{f(!0)},children:"Add Contract"})]}),(0,t.jsx)("div",{className:"p-4",children:0===p.length?(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"No contracts found."}):(0,t.jsxs)(d.XI,{children:[(0,t.jsx)(d.A0,{children:(0,t.jsxs)(d.Hj,{className:"hover:bg-transparent",children:[(0,t.jsx)(d.nd,{children:"Contract Address"}),(0,t.jsx)(d.nd,{children:"Network"}),(0,t.jsx)(d.nd,{children:"Type"}),(0,t.jsx)(d.nd,{children:"Status"}),(0,t.jsx)(d.nd,{children:"Date Created"})]})}),(0,t.jsx)(d.BF,{children:p.map(e=>{var l;return(0,t.jsxs)(d.Hj,{onClick:()=>j(e.name||e.id),className:"cursor-pointer",children:[(0,t.jsx)(d.nA,{className:"font-mono",children:(l=e.paymentContractAddress)?"".concat(l.slice(0,8),"...").concat(l.slice(-4)):""}),(0,t.jsx)(d.nA,{children:e.network}),(0,t.jsx)(d.nA,{children:"Payment Contract"}),(0,t.jsx)(d.nA,{children:(0,t.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(e.isSyncing?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"),children:e.isSyncing?"Syncing":"Active"})}),(0,t.jsx)(d.nA,{children:new Date(e.createdAt).toLocaleString()})]},e.id)})})]})}),h&&(0,t.jsx)(g,{onClose:()=>f(!1)})]})}var y=s(3368),b=s.n(y),N=!0;function w(e){let{initialPaymentSources:l}=e,{state:s}=(0,o.Us)(),n=s.paymentSources.length>0?s.paymentSources:l;return(0,t.jsxs)("div",{className:"",children:[(0,t.jsx)(b(),{children:(0,t.jsx)("title",{children:"Masumi | Admin Interface"})}),(0,t.jsx)(a.O,{children:(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsx)(v,{paymentSourceData:n})})})]})}}},e=>{var l=l=>e(e.s=l);e.O(0,[893,690,627,551,75,974,636,593,792],()=>l(2022)),_N_E=e.O()}]);